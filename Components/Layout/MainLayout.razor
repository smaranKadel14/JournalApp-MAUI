@inherits LayoutComponentBase
@inject JournalApp.Services.ThemeService Theme
@inject JournalApp.Services.UserService UserSession
@inject NavigationManager Nav

<div class="app-root @Theme.CssClass">
    <div class="page">
        @* Hide sidebar completely for non-authenticated users and auth pages *@
        @if (UserSession.IsLoggedIn && !Nav.Uri.Contains("/login") && !Nav.Uri.Contains("/signup"))
        {
            <div class="sidebar">
                <div class="navbar-brand">
                    <img src="/icon-192.png" alt="Journal Logo" class="navbar-logo" />
                    <span class="navbar-title">Journal</span>
                </div>
                <NavMenu />
            </div>
        }

        <main>
            @* Hide "Switch User" for non-authenticated users and auth pages *@
            @if (UserSession.IsLoggedIn && !Nav.Uri.Contains("/login") && !Nav.Uri.Contains("/signup"))
            {
                <div class="top-row px-4">
                    <a href="login">Switch User</a>
                </div>
            }

            <article class="content px-4">
                @Body
            </article>
        </main>
    </div>
</div>

@code {
    protected override void OnInitialized()
    {
        Theme.OnChange += OnThemeChanged;
    }

    private void OnThemeChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        Theme.OnChange -= OnThemeChanged;
    }
}
