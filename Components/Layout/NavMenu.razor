@using JournalApp.Services
@implements IDisposable
@inject UserService UserSession
@inject NavigationManager Nav

<div class="nav-scrollable">
    <nav class="flex-column">

        <div class="nav-item px-3">
            <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">Home</NavLink>
        </div>

        @if (UserSession.IsLoggedIn)
        {
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/dashboard">Dashboard</NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/entries">Entries</NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/new-entry">New Entry</NavLink>
            </div>

            <div class="nav-item px-3">
                <button type="button" class="nav-link btn btn-link p-0" style="cursor:pointer" @onclick="Logout">
                    Logout
                </button>
            </div>
        }
        else
        {
            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/login">Login</NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/signup">Signup</NavLink>
            </div>
        }
    </nav>
</div>

@code {
    protected override void OnInitialized()
    {
        // I subscribe so the nav updates immediately after login/logout
        UserSession.OnChange += HandleUserStateChanged;
    }

    private void HandleUserStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    private void Logout()
    {
        UserSession.Logout();
        Nav.NavigateTo("/login");
    }

    public void Dispose()
    {
        // I unsubscribe to avoid memory leaks
        UserSession.OnChange -= HandleUserStateChanged;
    }
}
