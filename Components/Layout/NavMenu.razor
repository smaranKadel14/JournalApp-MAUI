@using JournalApp.Services
@implements IDisposable
@inject UserService UserSession
@inject NavigationManager Nav

@* Hide navigation completely for non-authenticated users on home page *@
@if (UserSession.IsLoggedIn)
{
    <div class="nav-scrollable">
        <nav class="flex-column">

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/" Match="NavLinkMatch.All">
                    <img src="/icons/home.svg" width="18" height="18" alt="Home" class="nav-icon" />
                    Home
                </NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/dashboard">
                    <img src="/icons/dashboard.svg" width="18" height="18" alt="Dashboard" class="nav-icon" />
                    Dashboard
                </NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/calendar">
                    <img src="/icons/calendar.svg" width="18" height="18" alt="Calendar" class="nav-icon" />
                    Calendar
                </NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/entries">
                    <img src="/icons/document.svg" width="18" height="18" alt="Entries" class="nav-icon" />
                    Entries
                </NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/new-entry">
                    <img src="/icons/plus.svg" width="18" height="18" alt="New Entry" class="nav-icon" />
                    New Entry
                </NavLink>
            </div>

            <div class="nav-item px-3">
                <NavLink class="nav-link" href="/settings">
                    <img src="/icons/settings.svg" width="18" height="18" alt="Settings" class="nav-icon" />
                    Settings
                </NavLink>
            </div>
        </nav>
    </div>
}

@code {
    protected override void OnInitialized()
    {
        // Subscribe so the nav updates immediately after login/logout
        UserSession.OnChange += HandleUserStateChanged;
    }

    private void HandleUserStateChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        // Unsubscribe to avoid memory leaks
        UserSession.OnChange -= HandleUserStateChanged;
    }
}
